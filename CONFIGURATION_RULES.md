# Правила конфигурации PATRIOT системы

## Критическое правило работы с переменными окружения

⚠️ **ВАЖНО**: Всегда используйте `config.py` для доступа к конфигурации, НИКОГДА не обращайтесь к переменным окружения напрямую через `os.getenv()`!

### Правильный подход
```python
# ✅ ПРАВИЛЬНО
from config import BINANCE_TESTNET, NETWORK_MODE, BINANCE_API_KEY

if BINANCE_TESTNET:
    print("Работаем в TESTNET")
else:
    print("Работаем в MAINNET")
```

### Неправильный подход
```python
# ❌ НЕПРАВИЛЬНО - НЕ ДЕЛАЙТЕ ТАК!
import os
testnet_mode = os.getenv('BINANCE_TESTNET', 'true').lower() == 'true'
```

## Почему это критично?

1. **Инициализация env_loader**: Файл `config.py` правильно загружает `.env` через `env_loader`, обеспечивая доступ к переменным
2. **Консистентность**: Все части системы видят одинаковые значения конфигурации
3. **Отладка**: Легче диагностировать проблемы, когда конфигурация централизована
4. **Безопасность**: Единая точка валидации и загрузки секретных данных

## Структура конфигурации

```
.env (секретные данные)
    ↓
env_loader.py (загрузка)
    ↓  
config.py (центральная конфигурация)
    ↓
все остальные модули (импортируют из config)
```

## Обнаруженная проблема

В процессе отладки выявлено, что прямые вызовы `os.getenv('BINANCE_TESTNET')` возвращают `None`, 
в то время как `config.py` корректно загружает значение `False` для режима MAINNET.

### Результат отладки:
```
Raw BINANCE_TESTNET: 'None'        # os.getenv() - НЕПРАВИЛЬНО
Config BINANCE_TESTNET: False       # config.py - ПРАВИЛЬНО  
NETWORK_MODE: MAINNET               # Корректное определение режима
```

## Исправленные файлы

В следующих файлах заменена неправильная логика на использование `config.py`:
- `production_readiness_check.py` - 3 места с fallback логикой
- (добавляйте сюда исправленные файлы)

## Чеклист для новых файлов

Перед добавлением в продакшн проверьте:

- [ ] Импортируется конфигурация из `config.py`
- [ ] Нет прямых вызовов `os.getenv()` для переменных из `.env`
- [ ] Используется `BINANCE_TESTNET` и `NETWORK_MODE` из config
- [ ] Тестируется в обеих режимах (testnet/mainnet)

## Переменные окружения в .env

```bash
# Режим сети (для продакшена)
BINANCE_TESTNET=false

# API ключи для MAINNET
BINANCE_API_KEY=your_mainnet_api_key
BINANCE_SECRET_KEY=your_mainnet_secret_key

# API ключи для TESTNET  
BINANCE_TESTNET_API_KEY=your_testnet_api_key
BINANCE_TESTNET_SECRET_KEY=your_testnet_secret_key
```

## Последствия нарушения правила

- Неправильное определение режима работы (testnet/mainnet)
- Использование неправильных API ключей
- Потенциальные финансовые потери в продакшене
- Сложность отладки из-за непоследовательности конфигурации

---
*Создано: 20.07.2025 - после отладки конфликта конфигурации*
